<svg viewBox="0 0 1400 800" xmlns="http://www.w3.org/2000/svg">
  <!-- Define styles -->
  <defs>
    <style>
      .title-text { font-family: 'Microsoft YaHei', Arial; font-size: 28px; font-weight: bold; fill: #2e7d32; }
      .layer-title { font-family: 'Microsoft YaHei', Arial; font-size: 16px; font-weight: bold; fill: #1565c0; }
      .component-name { font-family: 'Microsoft YaHei', Arial; font-size: 14px; font-weight: bold; fill: #1b5e20; }
      .normal-text { font-family: 'Microsoft YaHei', Arial; font-size: 11px; fill: #424242; }
      .small-text { font-family: 'Microsoft YaHei', Arial; font-size: 10px; fill: #757575; }
      .improvement-text { font-family: 'Microsoft YaHei', Arial; font-size: 10px; fill: #2e7d32; font-weight: bold; }
      .dependency-label { font-family: 'Microsoft YaHei', Arial; font-size: 9px; fill: #1565c0; font-style: italic; }

      /* Layer styles */
      .management-layer { fill: #e8f5e8; stroke: #4caf50; stroke-width: 3; }
      .vm-layer { fill: #e3f2fd; stroke: #2196f3; stroke-width: 3; }
      .arch-layer { fill: #fff3e0; stroke: #ff9800; stroke-width: 2; }
      .common-layer { fill: #f3e5f5; stroke: #9c27b0; stroke-width: 2; }
      .platform-layer { fill: #fce4ec; stroke: #e91e63; stroke-width: 2; }

      /* Dependency arrows */
      .clean-dependency { stroke: #4caf50; stroke-width: 3; fill: none; marker-end: url(#arrow-green); }
      .api-dependency { stroke: #2196f3; stroke-width: 2; fill: none; marker-end: url(#arrow-blue); }
      .arch-dependency { stroke: #ff9800; stroke-width: 2; fill: none; marker-end: url(#arrow-orange); }
      .internal-dependency { stroke: #9c27b0; stroke-width: 1.5; fill: none; marker-end: url(#arrow-purple); }
      .platform-dependency { stroke: #e91e63; stroke-width: 2; fill: none; marker-end: url(#arrow-pink); }

      /* Highlight boxes */
      .improvement-box { fill: #e8f5e8; stroke: #4caf50; stroke-width: 2; stroke-dasharray: 4,2; }
    </style>

    <!-- Arrow markers -->
    <marker id="arrow-green" markerWidth="12" markerHeight="10" refX="11" refY="5" orient="auto">
      <polygon points="0 0, 12 5, 0 10" fill="#4caf50" />
    </marker>
    <marker id="arrow-blue" markerWidth="12" markerHeight="10" refX="11" refY="5" orient="auto">
      <polygon points="0 0, 12 5, 0 10" fill="#2196f3" />
    </marker>
    <marker id="arrow-orange" markerWidth="12" markerHeight="10" refX="11" refY="5" orient="auto">
      <polygon points="0 0, 12 5, 0 10" fill="#ff9800" />
    </marker>
    <marker id="arrow-purple" markerWidth="12" markerHeight="10" refX="11" refY="5" orient="auto">
      <polygon points="0 0, 12 5, 0 10" fill="#9c27b0" />
    </marker>
    <marker id="arrow-pink" markerWidth="12" markerHeight="10" refX="11" refY="5" orient="auto">
      <polygon points="0 0, 12 5, 0 10" fill="#e91e63" />
    </marker>
  </defs>

  <!-- Title -->
  <text x="700" y="30" text-anchor="middle" class="title-text">AxVisor 重构后的分层架构</text>

  <!-- Layer 1: Management Layer -->
  <text x="50" y="80" class="layer-title">管理层 (Management Layer)</text>

  <rect x="50" y="90" width="1300" height="100" rx="8" class="management-layer"/>
  <rect x="100" y="110" width="300" height="70" rx="5" fill="white" stroke="#4caf50" stroke-width="2"/>
  <text x="250" y="135" text-anchor="middle" class="component-name">axvisor (内核)</text>
  <text x="250" y="155" text-anchor="middle" class="normal-text">VM生命周期管理</text>
  <text x="250" y="170" text-anchor="middle" class="small-text">vCPU调度、资源分配、策略管理</text>

  <rect x="500" y="110" width="300" height="70" rx="5" fill="white" stroke="#4caf50" stroke-width="2"/>
  <text x="650" y="135" text-anchor="middle" class="component-name">VM Manager</text>
  <text x="650" y="155" text-anchor="middle" class="normal-text">虚拟机实例管理</text>
  <text x="650" y="170" text-anchor="middle" class="small-text">创建、销毁、状态监控</text>

  <rect x="900" y="110" width="300" height="70" rx="5" fill="white" stroke="#4caf50" stroke-width="2"/>
  <text x="1050" y="135" text-anchor="middle" class="component-name">Resource Manager</text>
  <text x="1050" y="155" text-anchor="middle" class="normal-text">资源调度与分配</text>
  <text x="1050" y="170" text-anchor="middle" class="small-text">内存、CPU、设备资源管理</text>

  <!-- Layer 2: VM Layer -->
  <text x="50" y="230" class="layer-title">VM抽象层 (VM Abstraction Layer)</text>

  <rect x="50" y="240" width="1300" height="120" rx="8" class="vm-layer"/>

  <!-- VM Core Interface -->
  <rect x="100" y="260" width="250" height="80" rx="5" fill="white" stroke="#2196f3" stroke-width="2"/>
  <text x="225" y="285" text-anchor="middle" class="component-name">axvm::core</text>
  <text x="225" y="305" text-anchor="middle" class="normal-text">HypervisorCore trait</text>
  <text x="225" y="320" text-anchor="middle" class="improvement-text">✅ 统一接口，抹除架构差异</text>
  <text x="225" y="335" text-anchor="middle" class="small-text">VM创建、内存管理、设备绑定</text>

  <!-- VM Handle -->
  <rect x="380" y="260" width="250" height="80" rx="5" fill="white" stroke="#2196f3" stroke-width="2"/>
  <text x="505" y="285" text-anchor="middle" class="component-name">VmHandle trait</text>
  <text x="505" y="305" text-anchor="middle" class="normal-text">虚拟机实例操作接口</text>
  <text x="505" y="320" text-anchor="middle" class="small-text">vCPU管理、内存映射、状态控制</text>

  <!-- vCPU Handle -->
  <rect x="660" y="260" width="250" height="80" rx="5" fill="white" stroke="#2196f3" stroke-width="2"/>
  <text x="785" y="285" text-anchor="middle" class="component-name">VCpuHandle trait</text>
  <text x="785" y="305" text-anchor="middle" class="normal-text">简化vCPU操作接口</text>
  <text x="785" y="320" text-anchor="middle" class="improvement-text">✅ 核心操作，求同存异</text>
  <text x="785" y="335" text-anchor="middle" class="small-text">运行、暂停、状态管理、中断注入</text>

  <!-- Device Management -->
  <rect x="940" y="260" width="280" height="80" rx="5" fill="white" stroke="#2196f3" stroke-width="2"/>
  <text x="1080" y="285" text-anchor="middle" class="component-name">Device Management</text>
  <text x="1080" y="305" text-anchor="middle" class="normal-text">设备虚拟化统一接口</text>
  <text x="1080" y="320" text-anchor="middle" class="small-text">设备分配、配置、中断路由</text>

  <!-- Improvement highlight -->
  <circle cx="785" cy="290" r="85" fill="none" stroke="#2e7d32" stroke-width="2" stroke-dasharray="6,3"/>
  <text x="785" y="240" text-anchor="middle" class="improvement-text" style="font-size: 11px;">vCPU接口简化</text>

  <!-- Layer 3: Architecture Layer -->
  <text x="50" y="400" class="layer-title">架构层 (Architecture Layer)</text>

  <rect x="50" y="410" width="1300" height="140" rx="8" class="arch-layer"/>

  <!-- ARM64 Architecture with internal dependencies -->
  <rect x="100" y="430" width="280" height="40" rx="5" fill="white" stroke="#ff9800" stroke-width="2"/>
  <text x="240" y="455" text-anchor="middle" class="component-name">axvm::arch::aarch64</text>

  <!-- ARM64 Implementation Modules -->
  <rect x="80" y="480" width="130" height="30" rx="3" fill="#fff3e0" stroke="#ff6f00" stroke-width="1"/>
  <text x="145" y="500" text-anchor="middle" class="small-text">arm_vcpu</text>

  <rect x="230" y="480" width="130" height="30" rx="3" fill="#fff3e0" stroke="#ff6f00" stroke-width="1"/>
  <text x="295" y="500" text-anchor="middle" class="small-text">arm_vgic</text>

  <rect x="80" y="515" width="130" height="30" rx="3" fill="#fff3e0" stroke="#ff6f00" stroke-width="1"/>
  <text x="145" y="535" text-anchor="middle" class="small-text">arm_memory</text>

  <rect x="230" y="515" width="130" height="30" rx="3" fill="#fff3e0" stroke="#ff6f00" stroke-width="1"/>
  <text x="295" y="535" text-anchor="middle" class="small-text">arm_timer</text>

  <!-- x86_64 Architecture with internal dependencies -->
  <rect x="400" y="430" width="280" height="40" rx="5" fill="white" stroke="#ff9800" stroke-width="2"/>
  <text x="540" y="455" text-anchor="middle" class="component-name">axvm::arch::x86_64</text>

  <!-- x86_64 Implementation Modules -->
  <rect x="380" y="480" width="130" height="30" rx="3" fill="#fff3e0" stroke="#ff6f00" stroke-width="1"/>
  <text x="445" y="500" text-anchor="middle" class="small-text">x86_vcpu</text>

  <rect x="530" y="480" width="130" height="30" rx="3" fill="#fff3e0" stroke="#ff6f00" stroke-width="1"/>
  <text x="595" y="500" text-anchor="middle" class="small-text">x86_apic</text>

  <rect x="380" y="515" width="130" height="30" rx="3" fill="#fff3e0" stroke="#ff6f00" stroke-width="1"/>
  <text x="445" y="535" text-anchor="middle" class="small-text">x86_ept</text>

  <rect x="530" y="515" width="130" height="30" rx="3" fill="#fff3e0" stroke="#ff6f00" stroke-width="1"/>
  <text x="595" y="535" text-anchor="middle" class="small-text">x86_vmx</text>

  <!-- RISC-V Architecture with internal dependencies -->
  <rect x="700" y="430" width="280" height="40" rx="5" fill="white" stroke="#ff9800" stroke-width="2"/>
  <text x="840" y="455" text-anchor="middle" class="component-name">axvm::arch::riscv64</text>

  <!-- RISC-V Implementation Modules -->
  <rect x="680" y="480" width="130" height="30" rx="3" fill="#fff3e0" stroke="#ff6f00" stroke-width="1"/>
  <text x="745" y="500" text-anchor="middle" class="small-text">riscv_vcpu</text>

  <rect x="830" y="480" width="130" height="30" rx="3" fill="#fff3e0" stroke="#ff6f00" stroke-width="1"/>
  <text x="895" y="500" text-anchor="middle" class="small-text">riscv_imsic</text>

  <rect x="680" y="515" width="130" height="30" rx="3" fill="#fff3e0" stroke="#ff6f00" stroke-width="1"/>
  <text x="745" y="535" text-anchor="middle" class="small-text">riscv_sv39</text>

  <rect x="830" y="515" width="130" height="30" rx="3" fill="#fff3e0" stroke="#ff6f00" stroke-width="1"/>
  <text x="895" y="535" text-anchor="middle" class="small-text">riscv_aia</text>

  <!-- Architecture Internal Dependencies -->
  <!-- aarch64 → arm_vcpu, arm_vgic -->
  <path d="M 240 470 L 145 480" class="arch-dependency"/>
  <path d="M 240 470 L 295 480" class="arch-dependency"/>

  <!-- x86_64 → x86_vcpu, x86_apic -->
  <path d="M 540 470 L 445 480" class="arch-dependency"/>
  <path d="M 540 470 L 595 480" class="arch-dependency"/>

  <!-- riscv64 → riscv_vcpu, riscv_imsic -->
  <path d="M 840 470 L 745 480" class="arch-dependency"/>
  <path d="M 840 470 L 895 480" class="arch-dependency"/>

  <!-- Architecture Dependencies Illustration -->
  <rect x="1020" y="430" width="280" height="100" rx="5" fill="#fff8e1" stroke="#ffa000" stroke-width="1"/>
  <text x="1160" y="450" text-anchor="middle" class="component-name">架构层内部依赖</text>
  <text x="1030" y="470" class="small-text">• axvm::arch::aarch64 → arm_vcpu</text>
  <text x="1030" y="485" class="small-text">• axvm::arch::aarch64 → arm_vgic</text>
  <text x="1030" y="500" class="small-text">• axvm::arch::x86_64 → x86_vcpu</text>
  <text x="1030" y="515" class="small-text">• axvm::arch::riscv64 → riscv_imsic</text>

  <!-- Layer 4: Common Layer -->
  <text x="50" y="590" class="layer-title">共性层 (Common Layer)</text>

  <rect x="50" y="600" width="1300" height="80" rx="8" class="common-layer"/>

  <rect x="100" y="620" width="200" height="50" rx="5" fill="white" stroke="#9c27b0" stroke-width="2"/>
  <text x="200" y="640" text-anchor="middle" class="component-name">vcpu_utils</text>
  <text x="200" y="655" text-anchor="middle" class="small-text">通用算法、验证函数</text>

  <rect x="330" y="620" width="200" height="50" rx="5" fill="white" stroke="#9c27b0" stroke-width="2"/>
  <text x="430" y="640" text-anchor="middle" class="component-name">memory_utils</text>
  <text x="430" y="655" text-anchor="middle" class="small-text">内存管理、页表操作</text>

  <rect x="560" y="620" width="200" height="50" rx="5" fill="white" stroke="#9c27b0" stroke-width="2"/>
  <text x="660" y="640" text-anchor="middle" class="component-name">device_utils</text>
  <text x="660" y="655" text-anchor="middle" class="small-text">设备通用接口</text>

  <rect x="790" y="620" width="200" height="50" rx="5" fill="white" stroke="#9c27b0" stroke-width="2"/>
  <text x="890" y="640" text-anchor="middle" class="component-name">config_utils</text>
  <text x="890" y="655" text-anchor="middle" class="small-text">配置管理工具</text>

  <!-- Layer 5: Platform Layer -->
  <text x="50" y="720" class="layer-title">平台层 (Platform Layer)</text>

  <rect x="50" y="730" width="1300" height="50" rx="8" class="platform-layer"/>

  <rect x="200" y="745" width="150" height="30" rx="3" fill="white" stroke="#e91e63" stroke-width="2"/>
  <text x="275" y="765" text-anchor="middle" class="component-name">axruntime</text>

  <rect x="400" y="745" width="150" height="30" rx="3" fill="white" stroke="#e91e63" stroke-width="2"/>
  <text x="475" y="765" text-anchor="middle" class="component-name">axstd</text>

  <rect x="600" y="745" width="150" height="30" rx="3" fill="white" stroke="#e91e63" stroke-width="2"/>
  <text x="675" y="765" text-anchor="middle" class="component-name">axhal</text>

  <rect x="800" y="745" width="150" height="30" rx="3" fill="white" stroke="#e91e63" stroke-width="2"/>
  <text x="875" y="765" text-anchor="middle" class="component-name">axvmconfig</text>

  <!-- Clean Dependencies -->
  <!-- Management -> VM Layer -->
  <path d="M 250 180 L 225 260" class="clean-dependency"/>
  <path d="M 650 180 L 505 260" class="clean-dependency"/>
  <path d="M 1050 180 L 785 260" class="clean-dependency"/>
  <text x="600" y="220" class="dependency-label">✅ 单向依赖</text>

  <!-- VM Layer -> Architecture Layer -->
  <path d="M 225 340 L 240 430" class="api-dependency"/>
  <path d="M 505 340 L 540 430" class="api-dependency"/>
  <path d="M 785 340 L 840 430" class="api-dependency"/>
  <text x="500" y="380" class="dependency-label">接口实现</text>

  <!-- Architecture -> Common Layer -->
  <path d="M 240 530 L 200 620" class="arch-dependency"/>
  <path d="M 540 530 L 430 620" class="arch-dependency"/>
  <path d="M 840 530 L 660 620" class="arch-dependency"/>
  <path d="M 1160 530 L 890 620" class="arch-dependency"/>
  <text x="700" y="575" class="dependency-label">共享功能</text>

  <!-- Common -> Platform Layer -->
  <path d="M 200 670 L 275 745" class="internal-dependency"/>
  <path d="M 430 670 L 475 745" class="internal-dependency"/>
  <path d="M 660 670 L 675 745" class="internal-dependency"/>
  <path d="M 890 670 L 875 745" class="internal-dependency"/>
  <text x="550" y="710" class="dependency-label">底层依赖</text>

  <!-- Legend -->
  <rect x="1250" y="240" width="140" height="200" rx="8" fill="#f9f9f9" stroke="#cccccc" stroke-width="1"/>
  <text x="1320" y="260" text-anchor="middle" class="component-name" style="font-size: 14px;">依赖说明</text>

  <line x1="1260" y1="280" x2="1310" y2="280" class="clean-dependency"/>
  <text x="1315" y="285" class="small-text">管理层→VM层</text>

  <line x1="1260" y1="305" x2="1310" y2="305" class="api-dependency"/>
  <text x="1315" y="310" class="small-text">VM层→架构层</text>

  <line x1="1260" y1="330" x2="1310" y2="330" class="arch-dependency"/>
  <text x="1315" y="335" class="small-text">架构层→共性层</text>

  <line x1="1260" y1="355" x2="1310" y2="355" class="internal-dependency"/>
  <text x="1315" y="360" class="small-text">共性层→平台层</text>

  <rect x="1260" y="380" width="40" height="15" class="improvement-box"/>
  <text x="1305" y="392" class="small-text">关键改进</text>

  <!-- Key Improvements Summary -->
  <rect x="1250" y="420" width="140" height="120" rx="8" fill="#e8f5e8" stroke="#4caf50" stroke-width="1"/>
  <text x="1320" y="440" text-anchor="middle" class="improvement-text" style="font-size: 12px;">重构效果</text>
  <text x="1255" y="460" class="small-text">✅ 分层清晰</text>
  <text x="1255" y="475" class="small-text">✅ 单向依赖</text>
  <text x="1255" y="490" class="small-text">✅ 职责明确</text>
  <text x="1255" y="505" class="small-text">✅ 接口统一</text>
  <text x="1255" y="520" class="small-text">✅ 架构隔离</text>
  <text x="1255" y="535" class="small-text">✅ 可扩展性</text>

</svg>